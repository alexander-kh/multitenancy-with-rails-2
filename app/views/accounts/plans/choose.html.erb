<div class='row'>
  <div class='col-md-offset-3 col-md-6'>
    <div class='content'>
      <h2>Choose a plan</h2>
      
      <em>Plans are billed monthly.</em>
      <hr>
      
      <%= simple_form_for(current_account, url: choose_plan_url) do |account| %>
        <% @plans.each do |plan| %>
          <%= account.radio_button :plan_id, plan.id %>
          <%= account.label "plan_id_#{plan.id}", plan.name %>
          (<%= number_to_currency(plan.price) %>) <br>
        <% end %>
        
        <h3>Payment details</h3>
        <div id="payment-form"></div>
        
        <%= account.submit "Finish", class: "btn btn-primary" %>
      <% end %>
    </div>
    
    <% if current_account.braintree_subscription_id.present? %>
      <hr>
      <div class='text-center text-danger'>
        <small>
          <%= link_to "Cancel your subscription",
            cancel_subscription_path,
            method: :delete,
            data: {
              confirm: "Are you sure you would like to cancel your subscription?"
            }
          %>
        </small>
      </div>
    <% end %>
  </div>
</div>

<script src="https://js.braintreegateway.com/v2/braintree.js"></script>
<script>
  var clientToken = "<%= @client_token %>";
  
  braintree.setup(clientToken, "dropin", {
    container: "payment-form"
  });
</script>